<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Matematika Unik</title>
<style>
body {font-family: Arial, sans-serif; background: linear-gradient(to right,#006bb3,#ACB6E5); margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh;}
.container {background:#fff; max-width:720px; width:90%; padding:20px 30px; border-radius:15px; box-shadow:0 8px 20px rgba(0,0,0,0.3); text-align:center;}
h1,h2 {color:#333;}
button{padding:10px 20px;margin:5px;font-size:16px;border-radius:8px;border:none;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
.level-button{background:#2196F3;color:white;}
.answers button{display:block;width:100%;margin:5px 0;transition:0.3s;}
.correct{background-color:#4CAF50 !important;color:white;}
.wrong{background-color:#f44336 !important;color:white;}
#quiz-card{background:#f9f9f9;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.2);margin-bottom:10px;transition: transform 0.3s;}
.progress-container{background:#ddd;border-radius:12px;height:20px;margin:15px 0;}
.progress-bar{background:#4CAF50;height:100%;width:0%;border-radius:12px;transition: width 0.5s;}
.score,#timer,.leaderboard {margin-top:10px;font-size:18px;}
.leaderboard table{width:100%;border-collapse:collapse;margin-top:10px;}
.leaderboard th,.leaderboard td{border:1px solid #ccc;padding:5px;}
</style>
</head>
<body>
<div class="container">
<h1>Quiz Matematika</h1>

<div id="jenjang-selection">
<h2>Pilih Jenjang</h2>
<button onclick="selectJenjang('SD')">SD</button>
<button onclick="selectJenjang('SMP')">SMP</button>
<button onclick="selectJenjang('SMA')">SMA</button>
</div>

<div id="level-selection" style="display:none;">
<h2>Pilih Level <span id="jenjang-name"></span></h2>
<div id="level-buttons"></div>
<button onclick="backToJenjangSelection()">Kembali Pilih Jenjang</button>
</div>

<div id="quiz" style="display:none;">
<div id="quiz-card">
<h2 id="question"></h2>
<div id="timer">Waktu tersisa: 2:00</div>
<div class="answers" id="answers"></div>
<div class="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
<div class="score">Benar: <span id="correct">0</span> | Salah: <span id="wrong">0</span> | Total Skor: <span id="total-score">0</span></div>
<button onclick="endLevel()">Akhiri Level</button>
<button onclick="backToLevelSelection()">Pilih Level Lain</button>
</div>
</div>

<div id="result" style="display:none;">
<h2>Level Selesai!</h2>
<p>Benar: <span id="final-correct"></span></p>
<p>Salah: <span id="final-wrong"></span></p>
<p>Total Skor: <span id="final-total-score"></span></p>
<h3>Leaderboard Level <span id="leaderboard-level"></span></h3>
<div class="leaderboard" id="leaderboard"></div>
<button onclick="backToJenjangSelection()">Kembali Pilih Jenjang</button>
</div>
</div>

<script>
// Jenjang dan level
const jenjangLevels = {'SD':[1,2,3,4,5],'SMP':[6,7,8,9,10],'SMA':[11,12,13,14,15,16,17,18,19,20]};
const totalSoalPerLevel = 50;
let allQuestions=[], currentLevel=1, questionIndex=0, correct=0, wrong=0, totalScore=0;
let currentQuestions=[], timerInterval, timeLeft=120;
let leaderboard = JSON.parse(localStorage.getItem('quizLeaderboard')||'{}');
let selectedJenjang='';

// Pilih jenjang
function selectJenjang(j){ selectedJenjang=j; document.getElementById("jenjang-selection").style.display="none"; document.getElementById("level-selection").style.display="block"; document.getElementById("jenjang-name").textContent=j; createLevelButtons(j);}
function backToJenjangSelection(){document.getElementById("level-selection").style.display="none"; document.getElementById("jenjang-selection").style.display="block";}
function createLevelButtons(jenjang){const container=document.getElementById('level-buttons'); container.innerHTML=''; jenjangLevels[jenjang].forEach(l=>{let btn=document.createElement('button'); btn.textContent=`Level ${l}`; btn.className='level-button'; btn.onclick=()=>{currentLevel=l; startLevel();}; container.appendChild(btn);});}

// Fungsi gcd
function gcd(a,b){return b==0?a:gcd(b,a%b);}

// Simpan soal unik per level
function generateUniqueQuestions(level){
    const setSoal = new Set();
    const questions=[];
    while(questions.length<totalSoalPerLevel){
        let q = generateQuestion(level);
        if(!setSoal.has(q.questionText)){
            setSoal.add(q.questionText);
            questions.push(q);
        }
    }
    return questions;
}

// Generate soal sesuai jenjang & level
function generateQuestion(level){
    if(level<=5){ // SD
        if(level<=3){ // operasi dasar
            let a=Math.floor(Math.random()*(level*10))+1;
            let b=Math.floor(Math.random()*(level*10))+1;
            let op=Math.random()<0.5?'+':'-';
            let ans = op=='+'? a+b: a-b;
            return {questionText:`${a} ${op} ${b} = ?`, answer:ans};
        } else { // pecahan SD
            let a=Math.floor(Math.random()*9)+1, b=Math.floor(Math.random()*9)+1, c=Math.floor(Math.random()*9)+1, d=Math.floor(Math.random()*9)+1;
            let ops=['+','-','×','÷']; let op=ops[Math.floor(Math.random()*ops.length)];
            let num, den;
            switch(op){
                case '+': num=a*d + c*b; den=b*d; break;
                case '-': num=a*d - c*b; den=b*d; break;
                case '×': num=a*c; den=b*d; break;
                case '÷': num=a*d; den=b*c; break;
            }
            let g=gcd(Math.abs(num), Math.abs(den)); num/=g; den/=g;
            let ans = den==1 ? num : `${num}/${den}`;
            return {questionText:`${a}/${b} ${op} ${c}/${d} = ?`, answer:ans};
        }
    } else if(level<=10){ // SMP
        let type=Math.random();
        if(type<0.4){ // pecahan campuran
            let a=Math.floor(Math.random()*12)+1,b=Math.floor(Math.random()*12)+1,c=Math.floor(Math.random()*12)+1,d=Math.floor(Math.random()*12)+1;
            let ops=['+','-','×','÷']; let op=ops[Math.floor(Math.random()*ops.length)];
            let num, den;
            switch(op){
                case '+': num=a*d + c*b; den=b*d; break;
                case '-': num=a*d - c*b; den=b*d; break;
                case '×': num=a*c; den=b*d; break;
                case '÷': num=a*d; den=b*c; break;
            }
            let g=gcd(Math.abs(num), Math.abs(den)); num/=g; den/=g;
            let ans = den==1 ? num : `${num}/${den}`;
            return {questionText:`${a}/${b} ${op} ${c}/${d} = ?`, answer:ans};
        } else if(type<0.7){ // desimal
            let res = parseFloat((Math.random()*100).toFixed(Math.floor(Math.random()*2)+2));
            return {questionText:`Tulis nilai desimal: ${res}`, answer:res};
        } else { // akar kuadrat
            let n=[1,4,9,16,25,36,49,64,81,100]; let x=n[Math.floor(Math.random()*n.length)];
            return {questionText:`√${x} = ?`, answer:Math.sqrt(x)};
        }
    } else { // SMA
        let type=Math.random();
        if(type<0.3){ // trig sin/cos
            let angles=[0,30,45,60,90]; let angle=angles[Math.floor(Math.random()*angles.length)];
            let func=Math.random()<0.5?'sin':'cos';
            let val = func=='sin'?Math.sin(angle*Math.PI/180):Math.cos(angle*Math.PI/180);
            val = parseFloat(val.toFixed(Math.floor(Math.random()*2)+2));
            return {questionText:`${func}(${angle}°) = ?`, answer:val};
        } else if(type<0.6){ // log
            let base=[2,10]; let b=base[Math.floor(Math.random()*base.length)]; let val=[2,4,8,10,100][Math.floor(Math.random()*5)];
            return {questionText:`log base ${b} dari ${val} = ?`, answer:parseFloat((Math.log(val)/Math.log(b)).toFixed(Math.floor(Math.random()*2)+2))};
        } else { // pecahan/desimal
            let a=Math.floor(Math.random()*12)+1,b=Math.floor(Math.random()*12)+1,c=Math.floor(Math.random()*12)+1,d=Math.floor(Math.random()*12)+1;
            let ops=['+','-','×','÷']; let op=ops[Math.floor(Math.random()*ops.length)];
            let num, den;
            switch(op){
                case '+': num=a*d + c*b; den=b*d; break;
                case '-': num=a*d - c*b; den=b*d; break;
                case '×': num=a*c; den=b*d; break;
                case '÷': num=a*d; den=b*c; break;
            }
            let g=gcd(Math.abs(num), Math.abs(den)); num/=g; den/=g;
            let ans = den==1 ? num : `${num}/${den}`;
            return {questionText:`${a}/${b} ${op} ${c}/${d} = ?`, answer:ans};
        }
    }
}

// Generate semua soal unik
function generateAllQuestions(){
    for(let i=1;i<=20;i++){
        allQuestions.push(generateUniqueQuestions(i));
    }
}

// Mulai level
function startLevel(){
    currentQuestions=allQuestions[currentLevel-1]; questionIndex=0; correct=0; wrong=0; timeLeft=120;
    document.getElementById("correct").textContent=correct;
    document.getElementById("wrong").textContent=wrong;
    document.getElementById("total-score").textContent=totalScore;
    document.getElementById("progress-bar").style.width='0%';
    document.getElementById("level-selection").style.display="none";
    document.getElementById("quiz").style.display="block";
    showQuestion();
}

// Timer
function updateTimerDisplay(){
    let minutes = Math.floor(timeLeft/60);
    let seconds = timeLeft%60;
    document.getElementById("timer").textContent = `Waktu tersisa: ${minutes}:${seconds.toString().padStart(2,'0')}`;
}

// Tampilkan soal
function showQuestion(){
    if(questionIndex>=currentQuestions.length){ endLevel(); return;}
    clearInterval(timerInterval); timeLeft=120; updateTimerDisplay();
    timerInterval=setInterval(()=>{
        timeLeft--; updateTimerDisplay();
        if(timeLeft<=0){clearInterval(timerInterval); markWrong();}
    },1000);

    const q=currentQuestions[questionIndex];
    document.getElementById("question").textContent=q.questionText;
    const answersDiv=document.getElementById("answers"); answersDiv.innerHTML='';
    let choices=[q.answer];
    while(choices.length<4){
        let w=(typeof q.answer==='number')? parseFloat((q.answer+Math.random()*5-2).toFixed(Math.floor(Math.random()*2)+2)) : `${Math.floor(Math.random()*12)+1}/${Math.floor(Math.random()*12)+1}`;
        if(!choices.includes(w)) choices.push(w);
    }
    choices.sort(()=>Math.random()-0.5);
    choices.forEach(c=>{let btn=document.createElement('button'); btn.textContent=c; btn.onclick=()=>checkAnswer(c,btn); answersDiv.appendChild(btn);});
    document.getElementById("quiz-card").style.transform='scale(1.05)';
    setTimeout(()=>{document.getElementById("quiz-card").style.transform='scale(1)';},300);
}

// Cek jawaban
function checkAnswer(selected, btn){
    clearInterval(timerInterval);
    const correctAnswer=currentQuestions[questionIndex].answer;
    if(selected==correctAnswer){ correct++; totalScore+=10; btn.classList.add('correct');}
    else { wrong++; btn.classList.add('wrong'); }
    updateScore();
    setTimeout(()=>{ questionIndex++; showQuestion(); },500);
}
function markWrong(){ wrong++; updateScore(); questionIndex++; showQuestion();}
function updateScore(){
    document.getElementById("correct").textContent=correct;
    document.getElementById("wrong").textContent=wrong;
    document.getElementById("total-score").textContent=totalScore;
    document.getElementById("progress-bar").style.width=`${((questionIndex+1)/totalSoalPerLevel)*100}%`;
}

// Akhiri level
function endLevel(){
    clearInterval(timerInterval);
    document.getElementById("quiz").style.display="none";
    document.getElementById("final-correct").textContent=correct;
    document.getElementById("final-wrong").textContent=wrong;
    document.getElementById("final-total-score").textContent=totalScore;
    document.getElementById("leaderboard-level").textContent=currentLevel;
    updateLeaderboard();
    document.getElementById("result").style.display="block";
}

// Leaderboard
function updateLeaderboard(){
    if(!leaderboard[selectedJenjang]) leaderboard[selectedJenjang]={};
    if(!leaderboard[selectedJenjang][currentLevel] || leaderboard[selectedJenjang][currentLevel]<totalScore)
        leaderboard[selectedJenjang][currentLevel]=totalScore;
    localStorage.setItem('quizLeaderboard', JSON.stringify(leaderboard));
    let html='<table><tr><th>Level</th><th>Skor Tertinggi</th></tr>';
    for(let l in leaderboard[selectedJenjang]){
        html+=`<tr><td>${l}</td><td>${leaderboard[selectedJenjang][l]}</td></tr>`;
    }
    html+='</table>';
    document.getElementById("leaderboard").innerHTML=html;
}

function backToLevelSelection(){
    document.getElementById("quiz").style.display="none";
    document.getElementById("level-selection").style.display="block";
}

// Generate soal saat load
generateAllQuestions();
</script>
</body>
</html>
